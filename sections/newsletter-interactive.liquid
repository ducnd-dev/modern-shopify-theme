{% comment %}
  Interactive Newsletter Section with Unique Animations
  Particle effects, morphing shapes, and engaging micro-interactions
{% endcomment %}

<style>
  .newsletter-interactive-{{ section.id }} {
    --newsletter-primary: {{ section.settings.primary_color | default: '#0ea5e9' }};
    --newsletter-secondary: {{ section.settings.secondary_color | default: '#8b5cf6' }};
    --newsletter-accent: {{ section.settings.accent_color | default: '#f59e0b' }};
  }

  /* Particle Background */
  .particles-container {
    position: absolute;
    inset: 0;
    overflow: hidden;
    z-index: 1;
  }

  .particle {
    position: absolute;
    pointer-events: none;
    border-radius: 50%;
    background: radial-gradient(circle, var(--newsletter-accent), transparent 70%);
    animation: particleFloat 8s infinite linear;
  }

  @keyframes particleFloat {
    0% {
      transform: translateY(100vh) translateX(0) rotate(0deg);
      opacity: 0;
    }
    10% {
      opacity: 0.8;
    }
    90% {
      opacity: 0.8;
    }
    100% {
      transform: translateY(-100px) translateX(100px) rotate(360deg);
      opacity: 0;
    }
  }

  /* Morphing Blob Background */
  .blob-bg {
    position: absolute;
    inset: 0;
    background: linear-gradient(135deg, var(--newsletter-primary), var(--newsletter-secondary));
    overflow: hidden;
  }

  .blob {
    position: absolute;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.1);
    filter: blur(40px);
    animation: blobMorph 20s infinite ease-in-out;
  }

  .blob:nth-child(1) {
    width: 300px;
    height: 300px;
    top: 10%;
    left: 10%;
    animation-delay: 0s;
  }

  .blob:nth-child(2) {
    width: 200px;
    height: 200px;
    top: 50%;
    right: 20%;
    animation-delay: 7s;
  }

  .blob:nth-child(3) {
    width: 150px;
    height: 150px;
    bottom: 20%;
    left: 30%;
    animation-delay: 14s;
  }

  @keyframes blobMorph {
    0%, 100% {
      transform: translate(0, 0) scale(1);
      border-radius: 50%;
    }
    25% {
      transform: translate(30px, -20px) scale(1.2);
      border-radius: 30% 70% 70% 30% / 30% 30% 70% 70%;
    }
    50% {
      transform: translate(-20px, 20px) scale(0.8);
      border-radius: 70% 30% 30% 70% / 70% 70% 30% 30%;
    }
    75% {
      transform: translate(20px, 30px) scale(1.1);
      border-radius: 40% 60% 40% 60% / 60% 40% 60% 40%;
    }
  }

  /* Newsletter Form Styles */
  .newsletter-form {
    position: relative;
    z-index: 10;
    max-width: 600px;
    margin: 0 auto;
  }

  .form-container {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.3);
    border-radius: 25px;
    padding: 3rem;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
  }

  .form-container:hover {
    transform: translateY(-5px);
    box-shadow: 0 30px 60px rgba(0, 0, 0, 0.15);
  }

  .input-group {
    position: relative;
    margin-bottom: 2rem;
  }

  .floating-label {
    position: absolute;
    top: 50%;
    left: 1rem;
    transform: translateY(-50%);
    background: white;
    padding: 0 0.5rem;
    color: #666;
    transition: all 0.3s ease;
    pointer-events: none;
    z-index: 1;
  }

  .newsletter-input {
    width: 100%;
    padding: 1rem 1.5rem;
    border: 2px solid #e5e7eb;
    border-radius: 15px;
    font-size: 1rem;
    transition: all 0.3s ease;
    background: white;
  }

  .newsletter-input:focus {
    outline: none;
    border-color: var(--newsletter-primary);
    box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.1);
  }

  .newsletter-input:focus + .floating-label,
  .newsletter-input:not(:placeholder-shown) + .floating-label {
    top: 0;
    left: 1rem;
    font-size: 0.75rem;
    color: var(--newsletter-primary);
    background: white;
  }

  /* Animated Submit Button */
  .submit-btn {
    position: relative;
    width: 100%;
    padding: 1rem 2rem;
    background: linear-gradient(135deg, var(--newsletter-primary), var(--newsletter-secondary));
    border: none;
    border-radius: 15px;
    color: white;
    font-weight: 600;
    font-size: 1.1rem;
    cursor: pointer;
    overflow: hidden;
    transition: all 0.3s ease;
  }

  .submit-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
    transition: left 0.5s ease;
  }

  .submit-btn:hover::before {
    left: 100%;
  }

  .submit-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
  }

  .submit-btn:active {
    transform: translateY(0);
  }

  /* Loading Animation */
  .loading-spinner {
    display: none;
    width: 20px;
    height: 20px;
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-top: 2px solid white;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin-right: 0.5rem;
  }

  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  /* Success Animation */
  .success-message {
    display: none;
    text-align: center;
    padding: 2rem;
    background: rgba(34, 197, 94, 0.1);
    border: 2px solid #22c55e;
    border-radius: 15px;
    color: #22c55e;
    margin-top: 1rem;
    animation: successSlideIn 0.5s ease;
  }

  @keyframes successSlideIn {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Interactive Elements */
  .floating-icons {
    position: absolute;
    inset: 0;
    pointer-events: none;
    z-index: 2;
  }

  .floating-icon {
    position: absolute;
    font-size: 2rem;
    color: rgba(255, 255, 255, 0.6);
    animation: iconFloat 8s infinite ease-in-out;
  }

  .floating-icon:nth-child(1) {
    top: 15%;
    left: 10%;
    animation-delay: 0s;
  }

  .floating-icon:nth-child(2) {
    top: 25%;
    right: 15%;
    animation-delay: 2s;
  }

  .floating-icon:nth-child(3) {
    bottom: 20%;
    left: 20%;
    animation-delay: 4s;
  }

  .floating-icon:nth-child(4) {
    bottom: 30%;
    right: 25%;
    animation-delay: 6s;
  }

  @keyframes iconFloat {
    0%, 100% {
      transform: translateY(0) rotate(0deg);
      opacity: 0.6;
    }
    25% {
      transform: translateY(-20px) rotate(5deg);
      opacity: 0.8;
    }
    50% {
      transform: translateY(-10px) rotate(-5deg);
      opacity: 1;
    }
    75% {
      transform: translateY(-30px) rotate(3deg);
      opacity: 0.7;
    }
  }

  /* 3D Tilt Effect */
  .tilt-container {
    perspective: 1000px;
  }

  .tilt-element {
    transition: transform 0.1s ease;
    transform-style: preserve-3d;
  }

  /* Dark Mode Styles */
  .dark .form-container {
    background: rgba(38, 38, 38, 0.95);
    border-color: rgba(255, 255, 255, 0.1);
  }

  .dark .newsletter-input {
    background: rgba(38, 38, 38, 0.8);
    border-color: rgba(255, 255, 255, 0.2);
    color: white;
  }

  .dark .floating-label {
    background: rgba(38, 38, 38, 0.9);
    color: #d1d5db;
  }

  .dark .newsletter-input:focus + .floating-label,
  .dark .newsletter-input:not(:placeholder-shown) + .floating-label {
    background: rgba(38, 38, 38, 0.9);
  }
</style>

<section class="newsletter-interactive-{{ section.id }} relative min-h-screen flex items-center py-20">
  <!-- Background Effects -->
  {% case section.settings.background_style %}
    {% when 'particles' %}
      <div class="particles-container" id="particles-{{ section.id }}"></div>
      <div class="absolute inset-0 bg-gradient-to-br from-primary-600 to-primary-800"></div>
    
    {% when 'blobs' %}
      <div class="blob-bg">
        <div class="blob"></div>
        <div class="blob"></div>
        <div class="blob"></div>
      </div>
    
    {% when 'geometric' %}
      <div class="absolute inset-0 bg-gradient-to-br from-primary-500 to-secondary-600"></div>
      <div class="floating-icons">
        <div class="floating-icon">âœ¨</div>
        <div class="floating-icon">ðŸ“§</div>
        <div class="floating-icon">ðŸŽ¯</div>
        <div class="floating-icon">ðŸ’Ž</div>
      </div>
  {% endcase %}

  <div class="container mx-auto px-4 relative z-10">
    <div class="text-center mb-12">
      {% if section.settings.eyebrow_text != blank %}
        <div class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-white/10 backdrop-blur-sm border border-white/20 text-white mb-6">
          <div class="w-2 h-2 bg-yellow-400 rounded-full animate-pulse"></div>
          <span class="text-sm font-medium uppercase tracking-wider">{{ section.settings.eyebrow_text }}</span>
        </div>
      {% endif %}

      {% if section.settings.heading != blank %}
        <h2 class="text-4xl md:text-6xl lg:text-7xl font-black text-white mb-6 leading-tight">
          {{ section.settings.heading }}
        </h2>
      {% endif %}

      {% if section.settings.description != blank %}
        <p class="text-xl md:text-2xl text-white/80 max-w-3xl mx-auto leading-relaxed">
          {{ section.settings.description }}
        </p>
      {% endif %}
    </div>

    <!-- Newsletter Form -->
    <div class="tilt-container">
      <div class="newsletter-form tilt-element">
        <form class="form-container" id="newsletter-form-{{ section.id }}" action="#" method="post">
          <div class="input-group">
            <input 
              type="text" 
              class="newsletter-input" 
              name="name" 
              placeholder=" "
              required
            >
            <label class="floating-label">Your Name</label>
          </div>

          <div class="input-group">
            <input 
              type="email" 
              class="newsletter-input" 
              name="email" 
              placeholder=" "
              required
            >
            <label class="floating-label">Email Address</label>
          </div>

          {% if section.settings.show_phone_field %}
            <div class="input-group">
              <input 
                type="tel" 
                class="newsletter-input" 
                name="phone" 
                placeholder=" "
              >
              <label class="floating-label">Phone Number (Optional)</label>
            </div>
          {% endif %}

          {% if section.settings.show_interests_field %}
            <div class="input-group">
              <select class="newsletter-input" name="interests">
                <option value="">Select Your Interests</option>
                <option value="fashion">Fashion</option>
                <option value="technology">Technology</option>
                <option value="lifestyle">Lifestyle</option>
                <option value="business">Business</option>
                <option value="health">Health & Wellness</option>
              </select>
              <label class="floating-label">Interests</label>
            </div>
          {% endif %}

          <button type="submit" class="submit-btn">
            <div class="loading-spinner"></div>
            <span class="btn-text">{{ section.settings.button_text | default: 'Join Our Newsletter' }}</span>
          </button>

          <div class="success-message" id="success-{{ section.id }}">
            <div class="flex items-center justify-center gap-2 mb-2">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
              </svg>
              <span class="font-semibold">Success!</span>
            </div>
            <p>Welcome to our newsletter! Check your email for confirmation.</p>
          </div>

          {% if section.settings.show_privacy_note %}
            <p class="text-sm text-center text-neutral-600 mt-4">
              By subscribing, you agree to our 
              <a href="{{ section.settings.privacy_url | default: '/pages/privacy-policy' }}" class="text-primary-600 hover:underline">Privacy Policy</a>
              and consent to receive updates from us.
            </p>
          {% endif %}
        </form>
      </div>
    </div>

    <!-- Additional Benefits -->
    {% if section.blocks.size > 0 %}
      <div class="grid md:grid-cols-3 gap-8 mt-16">
        {% for block in section.blocks %}
          <div class="text-center text-white">
            <div class="w-16 h-16 bg-white/10 backdrop-blur-sm border border-white/20 rounded-full flex items-center justify-center mx-auto mb-4">
              {% case block.settings.icon %}
                {% when 'email' %}
                  <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                  </svg>
                {% when 'gift' %}
                  <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v13m0-13V6a2 2 0 112 2h-2zm0 0V5.5A2.5 2.5 0 109.5 8H12zm-7 4h14M5 12a2 2 0 110-4h14a2 2 0 110 4M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"></path>
                  </svg>
                {% when 'star' %}
                  <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path>
                  </svg>
                {% else %}
                  <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                  </svg>
              {% endcase %}
            </div>
            <h3 class="text-lg font-semibold mb-2">{{ block.settings.title | default: 'Exclusive Updates' }}</h3>
            <p class="text-white/70">{{ block.settings.description | default: 'Get the latest news and offers directly to your inbox.' }}</p>
          </div>
        {% endfor %}
      </div>
    {% endif %}
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Particle animation
    const particlesContainer = document.getElementById('particles-{{ section.id }}');
    if (particlesContainer) {
      createParticles();
      setInterval(createParticles, 1000);
    }

    function createParticles() {
      for (let i = 0; i < 3; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        particle.style.left = Math.random() * 100 + '%';
        particle.style.width = particle.style.height = Math.random() * 10 + 5 + 'px';
        particle.style.animationDuration = Math.random() * 3 + 5 + 's';
        particle.style.animationDelay = Math.random() * 2 + 's';
        particlesContainer.appendChild(particle);

        setTimeout(() => {
          if (particle.parentNode) {
            particle.parentNode.removeChild(particle);
          }
        }, 8000);
      }
    }

    // 3D Tilt Effect
    const tiltElements = document.querySelectorAll('.tilt-element');
    tiltElements.forEach(element => {
      element.addEventListener('mousemove', (e) => {
        const rect = element.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        const centerX = rect.width / 2;
        const centerY = rect.height / 2;
        const rotateX = (y - centerY) / centerY * -10;
        const rotateY = (x - centerX) / centerX * 10;
        
        element.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg)`;
      });

      element.addEventListener('mouseleave', () => {
        element.style.transform = 'perspective(1000px) rotateX(0deg) rotateY(0deg)';
      });
    });

    // Form submission
    const form = document.getElementById('newsletter-form-{{ section.id }}');
    const submitBtn = form.querySelector('.submit-btn');
    const btnText = submitBtn.querySelector('.btn-text');
    const spinner = submitBtn.querySelector('.loading-spinner');
    const successMessage = document.getElementById('success-{{ section.id }}');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      // Show loading state
      btnText.style.display = 'none';
      spinner.style.display = 'inline-block';
      submitBtn.disabled = true;

      // Simulate API call
      await new Promise(resolve => setTimeout(resolve, 2000));

      // Show success
      btnText.style.display = 'inline';
      spinner.style.display = 'none';
      submitBtn.disabled = false;
      
      form.style.display = 'none';
      successMessage.style.display = 'block';

      // Reset after 5 seconds
      setTimeout(() => {
        form.style.display = 'block';
        successMessage.style.display = 'none';
        form.reset();
      }, 5000);
    });
  });
</script>

{% schema %}
{
  "name": "Interactive Newsletter",
  "tag": "section",
  "class": "section-interactive-newsletter",
  "settings": [
    {
      "type": "select",
      "id": "background_style",
      "label": "Background Style",
      "options": [
        {
          "value": "particles",
          "label": "Floating Particles"
        },
        {
          "value": "blobs",
          "label": "Morphing Blobs"
        },
        {
          "value": "geometric",
          "label": "Geometric Icons"
        }
      ],
      "default": "particles"
    },
    {
      "type": "color",
      "id": "primary_color",
      "label": "Primary Color",
      "default": "#0ea5e9"
    },
    {
      "type": "color",
      "id": "secondary_color",
      "label": "Secondary Color",
      "default": "#8b5cf6"
    },
    {
      "type": "color",
      "id": "accent_color",
      "label": "Accent Color",
      "default": "#f59e0b"
    },
    {
      "type": "text",
      "id": "eyebrow_text",
      "label": "Eyebrow Text",
      "default": "Newsletter"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Stay in the Loop"
    },
    {
      "type": "textarea",
      "id": "description",
      "label": "Description",
      "default": "Join thousands of subscribers and get exclusive access to new products, special offers, and insider updates."
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Button Text",
      "default": "Join Our Newsletter"
    },
    {
      "type": "checkbox",
      "id": "show_phone_field",
      "label": "Show Phone Field",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "show_interests_field",
      "label": "Show Interests Field",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "show_privacy_note",
      "label": "Show Privacy Note",
      "default": true
    },
    {
      "type": "url",
      "id": "privacy_url",
      "label": "Privacy Policy URL"
    }
  ],
  "blocks": [
    {
      "type": "benefit",
      "name": "Benefit",
      "limit": 3,
      "settings": [
        {
          "type": "select",
          "id": "icon",
          "label": "Icon",
          "options": [
            {
              "value": "email",
              "label": "Email"
            },
            {
              "value": "gift",
              "label": "Gift"
            },
            {
              "value": "star",
              "label": "Star"
            },
            {
              "value": "lightning",
              "label": "Lightning"
            }
          ],
          "default": "email"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Title",
          "default": "Exclusive Updates"
        },
        {
          "type": "textarea",
          "id": "description",
          "label": "Description",
          "default": "Get the latest news and offers directly to your inbox."
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Interactive Newsletter",
      "blocks": [
        {
          "type": "benefit",
          "settings": {
            "icon": "email",
            "title": "Weekly Updates",
            "description": "Fresh content delivered every week"
          }
        },
        {
          "type": "benefit",
          "settings": {
            "icon": "gift",
            "title": "Exclusive Offers",
            "description": "Special discounts just for subscribers"
          }
        },
        {
          "type": "benefit",
          "settings": {
            "icon": "star",
            "title": "VIP Access",
            "description": "Be first to know about new releases"
          }
        }
      ]
    }
  ]
}
{% endschema %}