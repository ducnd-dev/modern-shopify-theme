{{ 'section-product-grid.css' | asset_url | stylesheet_tag }}

{%- style -%}
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }

  @media screen and (min-width: 750px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }
{%- endstyle -%}

<section class="product-grid bg-white dark:bg-neutral-900 section-{{ section.id }}-padding">
  <div class="container mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Section Header -->
    <div class="text-center mb-12">
      {%- if section.settings.badge_text != blank -%}
        <span class="inline-block px-4 py-2 bg-primary-100 dark:bg-primary-900 text-primary-700 dark:text-primary-300 text-sm font-medium rounded-full mb-4">
          {{ section.settings.badge_text }}
        </span>
      {%- endif -%}
      
      {%- if section.settings.heading != blank -%}
        <h2 class="text-3xl sm:text-4xl lg:text-5xl font-bold text-neutral-900 dark:text-neutral-100 mb-4 font-display">
          {{ section.settings.heading }}
        </h2>
      {%- endif -%}
      
      {%- if section.settings.description != blank -%}
        <p class="text-lg text-neutral-600 dark:text-neutral-400 max-w-3xl mx-auto">
          {{ section.settings.description }}
        </p>
      {%- endif -%}
    </div>

    <!-- Filters -->
    {%- if section.settings.show_filters and section.settings.collection != blank -%}
      <div class="flex flex-wrap gap-2 justify-center mb-8" data-product-filters>
        <button 
          class="filter-btn active px-4 py-2 rounded-full text-sm font-medium transition-all duration-300 bg-primary-600 text-white" 
          data-filter="all"
        >
          All Products
        </button>
        {%- for tag in section.settings.collection.all_tags limit: 8 -%}
          <button 
            class="filter-btn px-4 py-2 rounded-full text-sm font-medium transition-all duration-300 bg-neutral-100 dark:bg-neutral-800 text-neutral-700 dark:text-neutral-300 hover:bg-primary-100 dark:hover:bg-primary-900" 
            data-filter="{{ tag | handle }}"
          >
            {{ tag }}
          </button>
        {%- endfor -%}
      </div>
    {%- endif -%}

    <!-- Product Grid -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 lg:gap-8" data-product-grid>
      {%- liquid
        assign collection_to_show = section.settings.collection
        if collection_to_show == blank
          assign collection_to_show = collections['all']
        endif
        
        assign products_to_show = section.settings.products_to_show | default: 8
      -%}

      {%- for product in collection_to_show.products limit: products_to_show -%}
        <div class="product-card group" data-product-tags="{{ product.tags | join: ' ' | handle }}">
          <div class="relative overflow-hidden rounded-2xl bg-neutral-100 dark:bg-neutral-800 transition-all duration-300 group-hover:shadow-lg">
            <!-- Product Image -->
            <div class="aspect-square relative overflow-hidden">
              {%- if product.featured_media -%}
                <img 
                  src="{{ product.featured_media | image_url: width: 400 }}"
                  srcset="{{ product.featured_media | image_url: width: 200 }} 200w,
                          {{ product.featured_media | image_url: width: 400 }} 400w,
                          {{ product.featured_media | image_url: width: 600 }} 600w"
                  sizes="(min-width: 1280px) 300px, (min-width: 1024px) 250px, (min-width: 640px) 200px, 300px"
                  alt="{{ product.featured_media.alt | escape }}"
                  class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110"
                  loading="lazy"
                >
                
                <!-- Second Image on Hover -->
                {%- if product.media[1] and section.settings.show_second_image -%}
                  <img 
                    src="{{ product.media[1] | image_url: width: 400 }}"
                    alt="{{ product.media[1].alt | escape }}"
                    class="absolute inset-0 w-full h-full object-cover transition-opacity duration-300 opacity-0 group-hover:opacity-100"
                    loading="lazy"
                  >
                {%- endif -%}
              {%- else -%}
                <div class="w-full h-full bg-gradient-to-br from-neutral-200 to-neutral-300 dark:from-neutral-700 dark:to-neutral-800 flex items-center justify-center">
                  <svg class="w-16 h-16 text-neutral-400 dark:text-neutral-600" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/>
                  </svg>
                </div>
              {%- endif -%}

              <!-- Badges -->
              <div class="absolute top-3 left-3 flex flex-col gap-2">
                {%- if product.compare_at_price > product.price -%}
                  {%- assign discount_percentage = product.compare_at_price | minus: product.price | times: 100 | divided_by: product.compare_at_price -%}
                  <span class="bg-red-500 text-white text-xs font-bold px-2 py-1 rounded-full">
                    -{{ discount_percentage }}%
                  </span>
                {%- endif -%}
                
                {%- if product.available == false -%}
                  <span class="bg-neutral-800 text-white text-xs font-medium px-2 py-1 rounded-full">
                    Sold Out
                  </span>
                {%- endif -%}
                
                {%- if product.tags contains 'new' -%}
                  <span class="bg-primary-500 text-white text-xs font-medium px-2 py-1 rounded-full">
                    New
                  </span>
                {%- endif -%}
              </div>

              <!-- Quick Actions -->
              <div class="absolute top-3 right-3 flex flex-col gap-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                <!-- Wishlist -->
                <button class="w-10 h-10 bg-white/90 backdrop-blur-sm rounded-full flex items-center justify-center transition-all duration-300 hover:bg-white hover:scale-110 focus:outline-none focus:ring-2 focus:ring-primary-500">
                  <svg class="w-5 h-5 text-neutral-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                  </svg>
                </button>
                
                <!-- Quick View -->
                <button class="w-10 h-10 bg-white/90 backdrop-blur-sm rounded-full flex items-center justify-center transition-all duration-300 hover:bg-white hover:scale-110 focus:outline-none focus:ring-2 focus:ring-primary-500" data-quick-view="{{ product.id }}">
                  <svg class="w-5 h-5 text-neutral-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                  </svg>
                </button>
              </div>

              <!-- Quick Add to Cart -->
              <div class="absolute bottom-3 left-3 right-3 opacity-0 group-hover:opacity-100 transform translate-y-2 group-hover:translate-y-0 transition-all duration-300">
                {%- if product.available -%}
                  <form action="{{ routes.cart_add_url }}" method="post" enctype="multipart/form-data" class="quick-add-form">
                    <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
                    <button 
                      type="submit" 
                      class="w-full bg-primary-600 hover:bg-primary-700 text-white font-semibold py-3 px-4 rounded-xl transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-primary-500 flex items-center justify-center gap-2"
                    >
                      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-2.5 5M7 13l2.5 5m0 0H17M9 18v.01M20 18v.01"></path>
                      </svg>
                      Quick Add
                    </button>
                  </form>
                {%- else -%}
                  <button disabled class="w-full bg-neutral-400 text-white font-semibold py-3 px-4 rounded-xl cursor-not-allowed">
                    Sold Out
                  </button>
                {%- endif -%}
              </div>
            </div>

            <!-- Product Info -->
            <div class="p-4">
              {%- if section.settings.show_vendor and product.vendor != blank -%}
                <p class="text-sm text-neutral-500 dark:text-neutral-400 mb-1">{{ product.vendor }}</p>
              {%- endif -%}
              
              <h3 class="font-semibold text-neutral-900 dark:text-neutral-100 mb-2 group-hover:text-primary-600 dark:group-hover:text-primary-400 transition-colors duration-300">
                <a href="{{ product.url }}" class="focus:outline-none focus:ring-2 focus:ring-primary-500 rounded">
                  {{ product.title }}
                </a>
              </h3>
              
              {%- if section.settings.show_rating -%}
                <div class="flex items-center gap-1 mb-2">
                  {%- for i in (1..5) -%}
                    <svg class="w-4 h-4 text-yellow-400" fill="currentColor" viewBox="0 0 24 24">
                      <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                    </svg>
                  {%- endfor -%}
                  <span class="text-sm text-neutral-500 dark:text-neutral-400 ml-1">({{ product.metafields.reviews.rating_count | default: 0 }})</span>
                </div>
              {%- endif -%}
              
              <div class="flex items-center gap-2">
                <span class="font-bold text-lg text-neutral-900 dark:text-neutral-100">
                  {{ product.price | money }}
                </span>
                {%- if product.compare_at_price > product.price -%}
                  <span class="text-sm text-neutral-500 dark:text-neutral-400 line-through">
                    {{ product.compare_at_price | money }}
                  </span>
                {%- endif -%}
              </div>
              
              {%- if section.settings.show_description and product.description != blank -%}
                <p class="text-sm text-neutral-600 dark:text-neutral-400 mt-2 line-clamp-2">
                  {{ product.description | strip_html | truncate: 80 }}
                </p>
              {%- endif -%}
            </div>
          </div>
        </div>
      {%- endfor -%}
    </div>

    <!-- Load More Button -->
    {%- if section.settings.show_load_more and collection_to_show.products_count > products_to_show -%}
      <div class="text-center mt-12">
        <button 
          class="inline-flex items-center px-8 py-4 bg-primary-600 hover:bg-primary-700 text-white font-semibold rounded-full transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-primary-500/50"
          data-load-more
        >
          Load More Products
          <svg class="ml-2 w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path>
          </svg>
        </button>
      </div>
    {%- endif -%}

    <!-- View All Button -->
    {%- if section.settings.button_label != blank -%}
      <div class="text-center mt-12">
        <a 
          href="{{ section.settings.button_link | default: collection_to_show.url }}" 
          class="inline-flex items-center px-8 py-4 border-2 border-primary-600 text-primary-600 hover:bg-primary-600 hover:text-white font-semibold rounded-full transition-all duration-300 focus:outline-none focus:ring-4 focus:ring-primary-500/50"
        >
          {{ section.settings.button_label }}
          <svg class="ml-2 w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
          </svg>
        </a>
      </div>
    {%- endif -%}
  </div>
</section>

<script>
  // Product filtering functionality
  document.addEventListener('DOMContentLoaded', function() {
    const filterButtons = document.querySelectorAll('[data-product-filters] .filter-btn');
    const productCards = document.querySelectorAll('.product-card');
    
    filterButtons.forEach(button => {
      button.addEventListener('click', function() {
        const filter = this.getAttribute('data-filter');
        
        // Update active button
        filterButtons.forEach(btn => btn.classList.remove('active', 'bg-primary-600', 'text-white'));
        filterButtons.forEach(btn => btn.classList.add('bg-neutral-100', 'dark:bg-neutral-800', 'text-neutral-700', 'dark:text-neutral-300'));
        this.classList.add('active', 'bg-primary-600', 'text-white');
        this.classList.remove('bg-neutral-100', 'dark:bg-neutral-800', 'text-neutral-700', 'dark:text-neutral-300');
        
        // Filter products
        productCards.forEach(card => {
          if (filter === 'all') {
            card.style.display = 'block';
          } else {
            const tags = card.getAttribute('data-product-tags');
            if (tags && tags.includes(filter)) {
              card.style.display = 'block';
            } else {
              card.style.display = 'none';
            }
          }
        });
      });
    });
  });
</script>

{% schema %}
{
  "name": "Product Grid",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "badge_text",
      "label": "Badge text"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Featured Products"
    },
    {
      "type": "textarea",
      "id": "description",
      "label": "Description"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Collection",
      "info": "Leave empty to show all products"
    },
    {
      "type": "range",
      "id": "products_to_show",
      "min": 4,
      "max": 50,
      "step": 2,
      "label": "Products to show",
      "default": 8
    },
    {
      "type": "header",
      "content": "Product card settings"
    },
    {
      "type": "checkbox",
      "id": "show_second_image",
      "label": "Show second image on hover",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_vendor",
      "label": "Show vendor",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "show_rating",
      "label": "Show product rating",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_description",
      "label": "Show product description",
      "default": false
    },
    {
      "type": "header",
      "content": "Filtering"
    },
    {
      "type": "checkbox",
      "id": "show_filters",
      "label": "Show collection tag filters",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_load_more",
      "label": "Show load more button",
      "default": true
    },
    {
      "type": "header",
      "content": "Button"
    },
    {
      "type": "text",
      "id": "button_label",
      "label": "Button label"
    },
    {
      "type": "url",
      "id": "button_link",
      "label": "Button link"
    },
    {
      "type": "header",
      "content": "Section padding"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Top padding",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Bottom padding",
      "default": 36
    }
  ],
  "presets": [
    {
      "name": "Product Grid"
    }
  ]
}
{% endschema %}