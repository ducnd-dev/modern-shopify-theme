{{ 'section-product-grid.css' | asset_url | stylesheet_tag }}

{%- style -%}
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }

  @media screen and (min-width: 750px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }
{%- endstyle -%}

<section class="product-grid bg-white dark:bg-neutral-900 section-{{ section.id }}-padding">
  <div class="container mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Section Header -->
    <div class="text-center mb-12">
      {%- if section.settings.badge_text != blank -%}
        <span class="inline-block px-4 py-2 bg-primary-100 dark:bg-primary-900 text-primary-700 dark:text-primary-300 text-sm font-medium rounded-full mb-4">
          {{ section.settings.badge_text }}
        </span>
      {%- endif -%}
      
      {%- if section.settings.heading != blank -%}
        <h2 class="text-3xl sm:text-4xl lg:text-5xl font-bold text-neutral-900 dark:text-neutral-100 mb-4 font-display">
          {{ section.settings.heading }}
        </h2>
      {%- endif -%}
      
      {%- if section.settings.description != blank -%}
        <p class="text-lg text-neutral-600 dark:text-neutral-400 max-w-3xl mx-auto">
          {{ section.settings.description }}
        </p>
      {%- endif -%}
    </div>

    <!-- Filters -->
    {%- if section.settings.show_filters and section.settings.collection != blank -%}
      <div class="flex flex-wrap gap-2 justify-center mb-8" data-product-filters>
        <button 
          class="filter-btn active px-4 py-2 rounded-full text-sm font-medium transition-all duration-300 bg-primary-600 text-white" 
          data-filter="all"
        >
          All Products
        </button>
        {%- for tag in section.settings.collection.all_tags limit: 8 -%}
          <button 
            class="filter-btn px-4 py-2 rounded-full text-sm font-medium transition-all duration-300 bg-neutral-100 dark:bg-neutral-800 text-neutral-700 dark:text-neutral-300 hover:bg-primary-100 dark:hover:bg-primary-900" 
            data-filter="{{ tag | handle }}"
          >
            {{ tag }}
          </button>
        {%- endfor -%}
      </div>
    {%- endif -%}

    <!-- Product Grid -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 lg:gap-8" data-product-grid>
      {%- liquid
        assign collection_to_show = section.settings.collection
        if collection_to_show == blank
          assign collection_to_show = collections['all']
        endif
        
        assign products_to_show = section.settings.products_to_show | default: 8
      -%}

      {%- for product in collection_to_show.products limit: products_to_show -%}
        <div class="product-card-wrapper" data-product-tags="{{ product.tags | join: ' ' | handle }}">
          {% render 'product-card-beautiful',
            product_card_product: product,
            media_aspect_ratio: 1.0,
            show_secondary_image: section.settings.show_second_image,
            show_vendor: section.settings.show_vendor,
            show_rating: section.settings.show_rating
          %}
        </div>
      {%- endfor -%}
    </div>

    <!-- Load More Button -->
    {%- if section.settings.show_load_more and collection_to_show.products_count > products_to_show -%}
      <div class="text-center mt-12">
        <button 
          class="inline-flex items-center px-8 py-4 bg-primary-600 hover:bg-primary-700 text-white font-semibold rounded-full transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-primary-500/50"
          data-load-more
        >
          Load More Products
          <svg class="ml-2 w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path>
          </svg>
        </button>
      </div>
    {%- endif -%}

    <!-- View All Button -->
    {%- if section.settings.button_label != blank -%}
      <div class="text-center mt-12">
        <a 
          href="{{ section.settings.button_link | default: collection_to_show.url }}" 
          class="inline-flex items-center px-8 py-4 border-2 border-primary-600 text-primary-600 hover:bg-primary-600 hover:text-white font-semibold rounded-full transition-all duration-300 focus:outline-none focus:ring-4 focus:ring-primary-500/50"
        >
          {{ section.settings.button_label }}
          <svg class="ml-2 w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
          </svg>
        </a>
      </div>
    {%- endif -%}
  </div>
</section>

<script>
  // Product filtering functionality
  document.addEventListener('DOMContentLoaded', function() {
    const filterButtons = document.querySelectorAll('[data-product-filters] .filter-btn');
    const productCards = document.querySelectorAll('.product-card-wrapper');
    
    filterButtons.forEach(button => {
      button.addEventListener('click', function() {
        const filter = this.getAttribute('data-filter');
        
        // Update active button
        filterButtons.forEach(btn => btn.classList.remove('active', 'bg-primary-600', 'text-white'));
        filterButtons.forEach(btn => btn.classList.add('bg-neutral-100', 'dark:bg-neutral-800', 'text-neutral-700', 'dark:text-neutral-300'));
        this.classList.add('active', 'bg-primary-600', 'text-white');
        this.classList.remove('bg-neutral-100', 'dark:bg-neutral-800', 'text-neutral-700', 'dark:text-neutral-300');
        
        // Filter products
        productCards.forEach(card => {
          if (filter === 'all') {
            card.style.display = 'block';
          } else {
            const tags = card.getAttribute('data-product-tags');
            if (tags && tags.includes(filter)) {
              card.style.display = 'block';
            } else {
              card.style.display = 'none';
            }
          }
        });
      });
    });
  });
</script>

{% schema %}
{
  "name": "Product Grid",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "badge_text",
      "label": "Badge text"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Featured Products"
    },
    {
      "type": "textarea",
      "id": "description",
      "label": "Description"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Collection",
      "info": "Leave empty to show all products"
    },
    {
      "type": "range",
      "id": "products_to_show",
      "min": 4,
      "max": 50,
      "step": 2,
      "label": "Products to show",
      "default": 8
    },
    {
      "type": "header",
      "content": "Product card settings"
    },
    {
      "type": "checkbox",
      "id": "show_second_image",
      "label": "Show second image on hover",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_vendor",
      "label": "Show vendor",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "show_rating",
      "label": "Show product rating",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_description",
      "label": "Show product description",
      "default": false
    },
    {
      "type": "header",
      "content": "Filtering"
    },
    {
      "type": "checkbox",
      "id": "show_filters",
      "label": "Show collection tag filters",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_load_more",
      "label": "Show load more button",
      "default": true
    },
    {
      "type": "header",
      "content": "Button"
    },
    {
      "type": "text",
      "id": "button_label",
      "label": "Button label"
    },
    {
      "type": "url",
      "id": "button_link",
      "label": "Button link"
    },
    {
      "type": "header",
      "content": "Section padding"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Top padding",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Bottom padding",
      "default": 36
    }
  ],
  "presets": [
    {
      "name": "Product Grid"
    }
  ]
}
{% endschema %}