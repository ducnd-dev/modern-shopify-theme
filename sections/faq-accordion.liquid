{% comment %}
  FAQ Accordion Section
  Advanced FAQ section with search, categories, and smooth animations
{% endcomment %}

<div class="faq-section py-16 bg-{{ section.settings.background_color }}">
  <div class="container mx-auto px-4">
    {% if section.settings.heading != blank or section.settings.subheading != blank %}
      <div class="text-center mb-12">
        {% if section.settings.heading != blank %}
          <h2 class="text-4xl md:text-5xl font-bold text-neutral-900 dark:text-neutral-100 mb-4">
            {{ section.settings.heading }}
          </h2>
        {% endif %}
        {% if section.settings.subheading != blank %}
          <p class="text-xl text-neutral-600 dark:text-neutral-400 max-w-3xl mx-auto">
            {{ section.settings.subheading }}
          </p>
        {% endif %}
      </div>
    {% endif %}

    <div class="max-w-4xl mx-auto">
      {% if section.settings.enable_search %}
        <!-- Search Bar -->
        <div class="mb-8">
          <div class="relative">
            <input 
              type="text" 
              id="faq-search"
              placeholder="{{ section.settings.search_placeholder | default: 'Search frequently asked questions...' }}"
              class="w-full px-6 py-4 pl-12 text-lg border border-neutral-300 dark:border-neutral-600 rounded-full bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
            >
            <svg class="absolute left-4 top-1/2 transform -translate-y-1/2 w-6 h-6 text-neutral-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
            </svg>
          </div>
        </div>
      {% endif %}

      {% if section.settings.enable_categories %}
        <!-- Category Filter -->
        {% assign categories = '' %}
        {% for block in section.blocks %}
          {% if block.settings.category != blank %}
            {% unless categories contains block.settings.category %}
              {% assign categories = categories | append: block.settings.category | append: ',' %}
            {% endunless %}
          {% endif %}
        {% endfor %}
        
        {% if categories != '' %}
          <div class="flex flex-wrap justify-center gap-2 mb-8" data-faq-categories>
            <button 
              class="category-btn active px-4 py-2 rounded-full text-sm font-medium bg-primary-600 text-white hover:bg-primary-700 transition-colors"
              data-category="all"
            >
              All Questions
            </button>
            
            {% assign category_array = categories | split: ',' %}
            {% for category in category_array %}
              {% if category != blank %}
                <button 
                  class="category-btn px-4 py-2 rounded-full text-sm font-medium bg-neutral-200 dark:bg-neutral-700 text-neutral-700 dark:text-neutral-300 hover:bg-neutral-300 dark:hover:bg-neutral-600 transition-colors"
                  data-category="{{ category | handle }}"
                >
                  {{ category }}
                </button>
              {% endif %}
            {% endfor %}
          </div>
        {% endif %}
      {% endif %}

      {% if section.blocks.size > 0 %}
        <!-- FAQ Accordion -->
        <div class="space-y-4" data-faq-container>
          {% for block in section.blocks %}
            {% case block.type %}
              {% when 'faq_item' %}
                <div 
                  class="faq-item bg-white dark:bg-neutral-800 rounded-xl shadow-sm border border-neutral-200 dark:border-neutral-700 overflow-hidden transition-all duration-300 hover:shadow-md"
                  data-category="{% if block.settings.category != blank %}{{ block.settings.category | handle }}{% else %}general{% endif %}"
                  data-question="{{ block.settings.question | downcase }}"
                  data-answer="{{ block.settings.answer | downcase }}"
                >
                  <button 
                    class="faq-trigger w-full px-6 py-6 text-left flex items-center justify-between focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-inset"
                    aria-expanded="false"
                  >
                    <div class="flex items-start gap-4">
                      {% if block.settings.icon != blank %}
                        <div class="flex-shrink-0 w-10 h-10 bg-primary-100 dark:bg-primary-900/30 rounded-lg flex items-center justify-center mt-1">
                          {% case block.settings.icon %}
                            {% when 'shipping' %}
                              <svg class="w-5 h-5 text-primary-600 dark:text-primary-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path>
                              </svg>
                            {% when 'payment' %}
                              <svg class="w-5 h-5 text-primary-600 dark:text-primary-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path>
                              </svg>
                            {% when 'returns' %}
                              <svg class="w-5 h-5 text-primary-600 dark:text-primary-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"></path>
                              </svg>
                            {% when 'sizing' %}
                              <svg class="w-5 h-5 text-primary-600 dark:text-primary-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                              </svg>
                            {% when 'support' %}
                              <svg class="w-5 h-5 text-primary-600 dark:text-primary-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 5.636l-3.536 3.536m0 5.656l3.536 3.536M9.172 9.172L5.636 5.636m3.536 9.192L5.636 18.364M12 2.25A9.75 9.75 0 1012 21.75 9.75 9.75 0 0012 2.25z"></path>
                              </svg>
                            {% when 'account' %}
                              <svg class="w-5 h-5 text-primary-600 dark:text-primary-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                              </svg>
                            {% else %}
                              <svg class="w-5 h-5 text-primary-600 dark:text-primary-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                              </svg>
                          {% endcase %}
                        </div>
                      {% endif %}
                      
                      <div class="flex-1 min-w-0">
                        <h3 class="text-lg font-semibold text-neutral-900 dark:text-neutral-100 leading-6">
                          {{ block.settings.question }}
                        </h3>
                        {% if block.settings.category != blank %}
                          <span class="inline-block mt-2 text-xs text-primary-600 dark:text-primary-400 bg-primary-100 dark:bg-primary-900/30 px-2 py-1 rounded-full">
                            {{ block.settings.category }}
                          </span>
                        {% endif %}
                      </div>
                    </div>
                    
                    <div class="flex-shrink-0 ml-4">
                      <svg class="faq-icon w-6 h-6 text-neutral-400 transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                      </svg>
                    </div>
                  </button>
                  
                  <div class="faq-content overflow-hidden transition-all duration-300 max-h-0">
                    <div class="px-6 pb-6">
                      {% if block.settings.icon != blank %}
                        <div class="ml-14">
                      {% else %}
                        <div>
                      {% endif %}
                        <div class="prose prose-neutral dark:prose-invert max-w-none text-neutral-600 dark:text-neutral-400 leading-relaxed">
                          {{ block.settings.answer | newline_to_br }}
                        </div>
                        
                        {% if block.settings.helpful_links != blank %}
                          <div class="mt-4 pt-4 border-t border-neutral-200 dark:border-neutral-600">
                            <h4 class="text-sm font-medium text-neutral-900 dark:text-neutral-100 mb-2">Helpful Links:</h4>
                            <div class="space-y-1">
                              {% assign links = block.settings.helpful_links | newline_to_br | split: '<br />' %}
                              {% for link in links %}
                                {% if link != blank %}
                                  <div class="text-sm">
                                    <a href="#" class="text-primary-600 dark:text-primary-400 hover:text-primary-700 dark:hover:text-primary-300 transition-colors">
                                      {{ link | strip }}
                                    </a>
                                  </div>
                                {% endif %}
                              {% endfor %}
                            </div>
                          </div>
                        {% endif %}
                      </div>
                    </div>
                  </div>
                </div>
            {% endcase %}
          {% endfor %}
        </div>

        <!-- No Results Message -->
        <div class="no-results hidden text-center py-12">
          <svg class="w-16 h-16 text-neutral-300 dark:text-neutral-600 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
          </svg>
          <h3 class="text-lg font-medium text-neutral-900 dark:text-neutral-100 mb-2">No results found</h3>
          <p class="text-neutral-600 dark:text-neutral-400">Try adjusting your search or browse all questions.</p>
        </div>

        <!-- Contact Support -->
        {% if section.settings.show_contact_support %}
          <div class="mt-12 text-center">
            <div class="bg-neutral-100 dark:bg-neutral-800 rounded-xl p-8">
              <h3 class="text-xl font-semibold text-neutral-900 dark:text-neutral-100 mb-2">
                {{ section.settings.contact_title | default: "Didn't find what you're looking for?" }}
              </h3>
              <p class="text-neutral-600 dark:text-neutral-400 mb-6">
                {{ section.settings.contact_description | default: "Our support team is here to help you with any questions." }}
              </p>
              {% if section.settings.contact_button_text != blank %}
                <a 
                  href="{{ section.settings.contact_button_url | default: '/pages/contact' }}"
                  class="inline-flex items-center gap-2 bg-primary-600 text-white px-6 py-3 rounded-full font-semibold hover:bg-primary-700 transition-colors"
                >
                  {{ section.settings.contact_button_text }}
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
                  </svg>
                </a>
              {% endif %}
            </div>
          </div>
        {% endif %}

      {% else %}
        <!-- Empty State -->
        <div class="text-center py-16">
          <svg class="w-16 h-16 text-neutral-300 dark:text-neutral-600 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
          <h3 class="text-lg font-medium text-neutral-900 dark:text-neutral-100 mb-2">No FAQs added yet</h3>
          <p class="text-neutral-600 dark:text-neutral-400">Add some frequently asked questions to help your customers.</p>
        </div>
      {% endif %}
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const faqTriggers = document.querySelectorAll('.faq-trigger');
    const searchInput = document.getElementById('faq-search');
    const categoryBtns = document.querySelectorAll('.category-btn');
    const faqItems = document.querySelectorAll('.faq-item');
    const noResults = document.querySelector('.no-results');

    // FAQ Accordion functionality
    faqTriggers.forEach(trigger => {
      trigger.addEventListener('click', function() {
        const faqItem = this.closest('.faq-item');
        const faqContent = faqItem.querySelector('.faq-content');
        const faqIcon = this.querySelector('.faq-icon');
        const isExpanded = this.getAttribute('aria-expanded') === 'true';

        // Close all other open FAQs (optional - remove if you want multiple open)
        {% if section.settings.single_open %}
          faqTriggers.forEach(otherTrigger => {
            if (otherTrigger !== trigger) {
              const otherItem = otherTrigger.closest('.faq-item');
              const otherContent = otherItem.querySelector('.faq-content');
              const otherIcon = otherTrigger.querySelector('.faq-icon');
              
              otherTrigger.setAttribute('aria-expanded', 'false');
              otherContent.style.maxHeight = '0px';
              otherIcon.style.transform = 'rotate(0deg)';
            }
          });
        {% endif %}

        // Toggle current FAQ
        if (isExpanded) {
          this.setAttribute('aria-expanded', 'false');
          faqContent.style.maxHeight = '0px';
          faqIcon.style.transform = 'rotate(0deg)';
        } else {
          this.setAttribute('aria-expanded', 'true');
          faqContent.style.maxHeight = faqContent.scrollHeight + 'px';
          faqIcon.style.transform = 'rotate(180deg)';
        }
      });
    });

    // Search functionality
    if (searchInput) {
      searchInput.addEventListener('input', function() {
        const searchTerm = this.value.toLowerCase().trim();
        filterFAQs(searchTerm, getActiveCategory());
      });
    }

    // Category filtering
    categoryBtns.forEach(btn => {
      btn.addEventListener('click', function() {
        const category = this.getAttribute('data-category');
        
        // Update active button
        categoryBtns.forEach(otherBtn => {
          otherBtn.classList.remove('active', 'bg-primary-600', 'text-white');
          otherBtn.classList.add('bg-neutral-200', 'dark:bg-neutral-700', 'text-neutral-700', 'dark:text-neutral-300');
        });
        
        this.classList.add('active', 'bg-primary-600', 'text-white');
        this.classList.remove('bg-neutral-200', 'dark:bg-neutral-700', 'text-neutral-700', 'dark:text-neutral-300');
        
        // Filter FAQs
        const searchTerm = searchInput ? searchInput.value.toLowerCase().trim() : '';
        filterFAQs(searchTerm, category);
      });
    });

    function getActiveCategory() {
      const activeBtn = document.querySelector('.category-btn.active');
      return activeBtn ? activeBtn.getAttribute('data-category') : 'all';
    }

    function filterFAQs(searchTerm, category) {
      let visibleCount = 0;

      faqItems.forEach(item => {
        const itemCategory = item.getAttribute('data-category');
        const question = item.getAttribute('data-question');
        const answer = item.getAttribute('data-answer');
        
        const matchesCategory = category === 'all' || itemCategory === category;
        const matchesSearch = !searchTerm || 
          question.includes(searchTerm) || 
          answer.includes(searchTerm);

        if (matchesCategory && matchesSearch) {
          item.style.display = 'block';
          item.style.animation = 'fadeInUp 0.3s ease forwards';
          visibleCount++;
        } else {
          item.style.display = 'none';
        }
      });

      // Show/hide no results message
      if (noResults) {
        if (visibleCount === 0) {
          noResults.classList.remove('hidden');
        } else {
          noResults.classList.add('hidden');
        }
      }
    }

    // Add animation styles
    const style = document.createElement('style');
    style.textContent = `
      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
    `;
    document.head.appendChild(style);
  });
</script>

{% schema %}
{
  "name": "FAQ Accordion",
  "tag": "section",
  "class": "section-faq",
  "settings": [
    {
      "type": "header",
      "content": "Section Settings"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Frequently Asked Questions"
    },
    {
      "type": "textarea",
      "id": "subheading",
      "label": "Subheading",
      "default": "Find answers to common questions about our products and services."
    },
    {
      "type": "select",
      "id": "background_color",
      "label": "Background Color",
      "options": [
        {
          "value": "transparent",
          "label": "Transparent"
        },
        {
          "value": "white",
          "label": "White"
        },
        {
          "value": "neutral-50",
          "label": "Light Gray"
        }
      ],
      "default": "white"
    },
    {
      "type": "header",
      "content": "Functionality"
    },
    {
      "type": "checkbox",
      "id": "enable_search",
      "label": "Enable Search",
      "default": true
    },
    {
      "type": "text",
      "id": "search_placeholder",
      "label": "Search Placeholder",
      "default": "Search frequently asked questions..."
    },
    {
      "type": "checkbox",
      "id": "enable_categories",
      "label": "Enable Category Filtering",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "single_open",
      "label": "Only one FAQ open at a time",
      "default": false
    },
    {
      "type": "header",
      "content": "Contact Support"
    },
    {
      "type": "checkbox",
      "id": "show_contact_support",
      "label": "Show Contact Support Section",
      "default": true
    },
    {
      "type": "text",
      "id": "contact_title",
      "label": "Contact Title",
      "default": "Didn't find what you're looking for?"
    },
    {
      "type": "textarea",
      "id": "contact_description",
      "label": "Contact Description",
      "default": "Our support team is here to help you with any questions."
    },
    {
      "type": "text",
      "id": "contact_button_text",
      "label": "Contact Button Text",
      "default": "Contact Support"
    },
    {
      "type": "url",
      "id": "contact_button_url",
      "label": "Contact Button URL",
      "default": "/pages/contact"
    }
  ],
  "blocks": [
    {
      "type": "faq_item",
      "name": "FAQ Item",
      "settings": [
        {
          "type": "text",
          "id": "question",
          "label": "Question",
          "default": "What is your return policy?"
        },
        {
          "type": "textarea",
          "id": "answer",
          "label": "Answer",
          "default": "We offer a 30-day return policy for all items in original condition. Please contact our support team to initiate a return."
        },
        {
          "type": "text",
          "id": "category",
          "label": "Category",
          "info": "Used for filtering (e.g., 'Shipping', 'Returns', 'Payment')"
        },
        {
          "type": "select",
          "id": "icon",
          "label": "Icon",
          "options": [
            {
              "value": "",
              "label": "None"
            },
            {
              "value": "shipping",
              "label": "Shipping"
            },
            {
              "value": "payment",
              "label": "Payment"
            },
            {
              "value": "returns",
              "label": "Returns"
            },
            {
              "value": "sizing",
              "label": "Sizing"
            },
            {
              "value": "support",
              "label": "Support"
            },
            {
              "value": "account",
              "label": "Account"
            }
          ],
          "default": ""
        },
        {
          "type": "textarea",
          "id": "helpful_links",
          "label": "Helpful Links",
          "info": "Add one link per line"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "FAQ Accordion",
      "blocks": [
        {
          "type": "faq_item",
          "settings": {
            "question": "What is your return policy?",
            "answer": "We offer a 30-day return policy for all items in original condition. Please contact our support team to initiate a return.",
            "category": "Returns",
            "icon": "returns"
          }
        },
        {
          "type": "faq_item",
          "settings": {
            "question": "How long does shipping take?",
            "answer": "Standard shipping takes 3-7 business days. Express shipping options are available for faster delivery.",
            "category": "Shipping",
            "icon": "shipping"
          }
        },
        {
          "type": "faq_item",
          "settings": {
            "question": "What payment methods do you accept?",
            "answer": "We accept all major credit cards, PayPal, Apple Pay, and Google Pay for your convenience.",
            "category": "Payment",
            "icon": "payment"
          }
        },
        {
          "type": "faq_item",
          "settings": {
            "question": "How do I find my size?",
            "answer": "Please refer to our detailed size guide available on each product page. If you're between sizes, we recommend sizing up.",
            "category": "Sizing",
            "icon": "sizing"
          }
        }
      ]
    }
  ]
}
{% endschema %}