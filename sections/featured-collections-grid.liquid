{% comment %}
  Featured Collections Grid Section
  Advanced collections display with filtering, animations, and responsive design
{% endcomment %}

<div class="featured-collections-section py-16 bg-{{ section.settings.background_color }}">
  <div class="container mx-auto px-4">
    {% if section.settings.heading != blank or section.settings.subheading != blank %}
      <div class="text-center mb-12">
        {% if section.settings.heading != blank %}
          <h2 class="text-4xl md:text-5xl font-bold text-neutral-900 dark:text-neutral-100 mb-4">
            {{ section.settings.heading }}
          </h2>
        {% endif %}
        {% if section.settings.subheading != blank %}
          <p class="text-xl text-neutral-600 dark:text-neutral-400 max-w-3xl mx-auto">
            {{ section.settings.subheading }}
          </p>
        {% endif %}
      </div>
    {% endif %}

    {% if section.blocks.size > 0 %}
      <!-- Filter Tabs -->
      {% assign has_categories = false %}
      {% for block in section.blocks %}
        {% if block.settings.category != blank %}
          {% assign has_categories = true %}
          {% break %}
        {% endif %}
      {% endfor %}

      {% if has_categories and section.settings.show_filters %}
        <div class="flex flex-wrap justify-center gap-2 mb-12" data-collection-filters>
          <button 
            class="filter-btn active px-6 py-3 rounded-full border border-neutral-200 dark:border-neutral-700 bg-primary-600 text-white hover:bg-primary-700 transition-all duration-300"
            data-filter="all"
          >
            All Collections
          </button>
          
          {% assign categories = '' %}
          {% for block in section.blocks %}
            {% if block.settings.category != blank %}
              {% unless categories contains block.settings.category %}
                {% assign categories = categories | append: block.settings.category | append: ',' %}
                <button 
                  class="filter-btn px-6 py-3 rounded-full border border-neutral-200 dark:border-neutral-700 bg-white dark:bg-neutral-800 text-neutral-700 dark:text-neutral-300 hover:bg-neutral-50 dark:hover:bg-neutral-700 transition-all duration-300"
                  data-filter="{{ block.settings.category | handle }}"
                >
                  {{ block.settings.category }}
                </button>
              {% endunless %}
            {% endif %}
          {% endfor %}
        </div>
      {% endif %}

      <!-- Collections Grid -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-{{ section.settings.columns_desktop }} gap-8" data-collections-grid>
        {% for block in section.blocks %}
          {% case block.type %}
            {% when 'collection' %}
              {% assign collection = collections[block.settings.collection] %}
              {% if collection != blank %}
                <div 
                  class="collection-card group cursor-pointer transform transition-all duration-500 hover:scale-105 hover:shadow-xl"
                  data-category="{% if block.settings.category != blank %}{{ block.settings.category | handle }}{% else %}uncategorized{% endif %}"
                  onclick="window.location.href='{{ collection.url }}'"
                >
                  <div class="relative overflow-hidden rounded-2xl bg-white dark:bg-neutral-800 shadow-lg border border-neutral-200 dark:border-neutral-700">
                    
                    <!-- Collection Image -->
                    <div class="relative aspect-[4/3] overflow-hidden">
                      {% if collection.featured_image %}
                        <img 
                          src="{{ collection.featured_image | image_url: width: 600 }}" 
                          alt="{{ collection.title }}"
                          class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110"
                          loading="lazy"
                        >
                      {% else %}
                        <div class="w-full h-full bg-gradient-to-br from-primary-100 to-primary-200 dark:from-primary-900 dark:to-primary-800 flex items-center justify-center">
                          <svg class="w-16 h-16 text-primary-400 dark:text-primary-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                          </svg>
                        </div>
                      {% endif %}

                      <!-- Overlay with CTA -->
                      <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-all duration-300 flex items-center justify-center">
                        <div class="transform translate-y-4 group-hover:translate-y-0 opacity-0 group-hover:opacity-100 transition-all duration-300">
                          <span class="inline-flex items-center gap-2 bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 px-6 py-3 rounded-full font-semibold shadow-lg">
                            Shop Now
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
                            </svg>
                          </span>
                        </div>
                      </div>

                      <!-- Badge -->
                      {% if block.settings.badge_text != blank %}
                        <div class="absolute top-4 left-4">
                          <span class="inline-block bg-{{ block.settings.badge_color | default: 'primary-600' }} text-white px-3 py-1 rounded-full text-sm font-semibold">
                            {{ block.settings.badge_text }}
                          </span>
                        </div>
                      {% endif %}

                      <!-- Product Count Badge -->
                      {% if section.settings.show_product_count %}
                        <div class="absolute top-4 right-4">
                          <span class="bg-white dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100 px-3 py-1 rounded-full text-sm font-medium shadow-md">
                            {{ collection.products_count }} 
                            {% if collection.products_count == 1 %}product{% else %}products{% endif %}
                          </span>
                        </div>
                      {% endif %}
                    </div>

                    <!-- Collection Info -->
                    <div class="p-6">
                      <div class="flex items-center justify-between mb-3">
                        <h3 class="text-xl font-bold text-neutral-900 dark:text-neutral-100 group-hover:text-primary-600 dark:group-hover:text-primary-400 transition-colors">
                          {{ collection.title }}
                        </h3>
                        {% if block.settings.category != blank %}
                          <span class="text-xs text-primary-600 dark:text-primary-400 bg-primary-100 dark:bg-primary-900/30 px-2 py-1 rounded-full font-medium">
                            {{ block.settings.category }}
                          </span>
                        {% endif %}
                      </div>

                      {% if collection.description != blank and section.settings.show_description %}
                        <p class="text-neutral-600 dark:text-neutral-400 text-sm leading-relaxed mb-4 line-clamp-2">
                          {{ collection.description | truncate: 120 }}
                        </p>
                      {% endif %}

                      <!-- Featured Products Preview -->
                      {% if section.settings.show_product_preview and collection.products.size > 0 %}
                        <div class="flex items-center gap-2 mb-4">
                          <span class="text-sm text-neutral-500 dark:text-neutral-500">Featured:</span>
                          <div class="flex -space-x-2">
                            {% for product in collection.products limit: 3 %}
                              {% if product.featured_image %}
                                <div class="w-8 h-8 rounded-full overflow-hidden border-2 border-white dark:border-neutral-800">
                                  <img 
                                    src="{{ product.featured_image | image_url: width: 32 }}" 
                                    alt="{{ product.title }}"
                                    class="w-full h-full object-cover"
                                    loading="lazy"
                                  >
                                </div>
                              {% endif %}
                            {% endfor %}
                            {% if collection.products.size > 3 %}
                              <div class="w-8 h-8 rounded-full bg-neutral-200 dark:bg-neutral-700 border-2 border-white dark:border-neutral-800 flex items-center justify-center">
                                <span class="text-xs font-medium text-neutral-600 dark:text-neutral-400">+{{ collection.products.size | minus: 3 }}</span>
                              </div>
                            {% endif %}
                          </div>
                        </div>
                      {% endif %}

                      <!-- Price Range -->
                      {% if section.settings.show_price_range %}
                        {% assign min_price = collection.products.first.price %}
                        {% assign max_price = collection.products.first.price %}
                        {% for product in collection.products limit: 50 %}
                          {% if product.price < min_price %}
                            {% assign min_price = product.price %}
                          {% endif %}
                          {% if product.price > max_price %}
                            {% assign max_price = product.price %}
                          {% endif %}
                        {% endfor %}
                        
                        {% if min_price and max_price %}
                          <div class="text-sm text-neutral-600 dark:text-neutral-400">
                            Price range: 
                            <span class="font-semibold text-neutral-900 dark:text-neutral-100">
                              {% if min_price == max_price %}
                                {{ min_price | money }}
                              {% else %}
                                {{ min_price | money }} - {{ max_price | money }}
                              {% endif %}
                            </span>
                          </div>
                        {% endif %}
                      {% endif %}
                    </div>
                  </div>
                </div>
              {% endif %}
          {% endcase %}
        {% endfor %}
      </div>

      <!-- View All Collections Button -->
      {% if section.settings.show_view_all and section.settings.view_all_url != blank %}
        <div class="text-center mt-12">
          <a 
            href="{{ section.settings.view_all_url }}"
            class="inline-flex items-center gap-2 bg-neutral-900 dark:bg-white text-white dark:text-neutral-900 px-8 py-4 rounded-full font-semibold hover:bg-neutral-800 dark:hover:bg-neutral-100 transition-colors"
          >
            View All Collections
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
            </svg>
          </a>
        </div>
      {% endif %}

    {% else %}
      <!-- Empty State -->
      <div class="text-center py-16">
        <svg class="w-16 h-16 text-neutral-300 dark:text-neutral-600 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
        </svg>
        <h3 class="text-lg font-medium text-neutral-900 dark:text-neutral-100 mb-2">No collections to display</h3>
        <p class="text-neutral-600 dark:text-neutral-400">Add some collections to showcase your products.</p>
      </div>
    {% endif %}
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const filterButtons = document.querySelectorAll('[data-collection-filters] .filter-btn');
    const collectionCards = document.querySelectorAll('.collection-card');

    if (filterButtons.length === 0) return;

    filterButtons.forEach(button => {
      button.addEventListener('click', function() {
        const filter = this.getAttribute('data-filter');

        // Update active button
        filterButtons.forEach(btn => {
          btn.classList.remove('active', 'bg-primary-600', 'text-white');
          btn.classList.add('bg-white', 'dark:bg-neutral-800', 'text-neutral-700', 'dark:text-neutral-300');
        });
        
        this.classList.add('active', 'bg-primary-600', 'text-white');
        this.classList.remove('bg-white', 'dark:bg-neutral-800', 'text-neutral-700', 'dark:text-neutral-300');

        // Filter collections
        collectionCards.forEach(card => {
          const cardCategory = card.getAttribute('data-category');
          
          if (filter === 'all' || cardCategory === filter) {
            card.style.display = 'block';
            card.style.animation = 'fadeInUp 0.5s ease forwards';
          } else {
            card.style.display = 'none';
          }
        });
      });
    });

    // Add CSS animations
    const style = document.createElement('style');
    style.textContent = `
      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      
      .line-clamp-2 {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }
    `;
    document.head.appendChild(style);
  });
</script>

{% schema %}
{
  "name": "Featured Collections Grid",
  "tag": "section", 
  "class": "section-featured-collections",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Shop by Collection"
    },
    {
      "type": "textarea",
      "id": "subheading",
      "label": "Subheading",
      "default": "Discover our carefully curated collections designed to fit your lifestyle."
    },
    {
      "type": "select",
      "id": "background_color",
      "label": "Background Color",
      "options": [
        {
          "value": "transparent",
          "label": "Transparent"
        },
        {
          "value": "white",
          "label": "White"
        },
        {
          "value": "neutral-50",
          "label": "Light Gray"
        },
        {
          "value": "neutral-100",
          "label": "Gray"
        }
      ],
      "default": "white"
    },
    {
      "type": "range",
      "id": "columns_desktop",
      "label": "Columns on Desktop",
      "min": 2,
      "max": 4,
      "step": 1,
      "default": 3
    },
    {
      "type": "header",
      "content": "Display Options"
    },
    {
      "type": "checkbox",
      "id": "show_filters",
      "label": "Show category filters",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_description",
      "label": "Show collection descriptions",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_product_count",
      "label": "Show product count",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_product_preview",
      "label": "Show product preview",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_price_range",
      "label": "Show price range",
      "default": true
    },
    {
      "type": "header",
      "content": "View All Button"
    },
    {
      "type": "checkbox",
      "id": "show_view_all",
      "label": "Show \"View All\" button",
      "default": true
    },
    {
      "type": "url",
      "id": "view_all_url",
      "label": "View All URL",
      "default": "/collections"
    }
  ],
  "blocks": [
    {
      "type": "collection",
      "name": "Collection",
      "settings": [
        {
          "type": "collection",
          "id": "collection",
          "label": "Collection"
        },
        {
          "type": "text",
          "id": "category",
          "label": "Category",
          "info": "Used for filtering (e.g., 'New Arrivals', 'Best Sellers', 'Sale')"
        },
        {
          "type": "text",
          "id": "badge_text",
          "label": "Badge Text",
          "info": "Optional badge to display on collection image"
        },
        {
          "type": "select",
          "id": "badge_color",
          "label": "Badge Color",
          "options": [
            {
              "value": "primary-600",
              "label": "Primary"
            },
            {
              "value": "red-600",
              "label": "Red"
            },
            {
              "value": "green-600",
              "label": "Green"
            },
            {
              "value": "blue-600",
              "label": "Blue"
            },
            {
              "value": "yellow-600",
              "label": "Yellow"
            },
            {
              "value": "purple-600",
              "label": "Purple"
            }
          ],
          "default": "primary-600"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Featured Collections Grid",
      "blocks": [
        {
          "type": "collection",
          "settings": {
            "category": "New Arrivals",
            "badge_text": "New",
            "badge_color": "green-600"
          }
        },
        {
          "type": "collection",
          "settings": {
            "category": "Best Sellers",
            "badge_text": "Popular",
            "badge_color": "blue-600"
          }
        },
        {
          "type": "collection",
          "settings": {
            "category": "Sale",
            "badge_text": "Sale",
            "badge_color": "red-600"
          }
        }
      ]
    }
  ]
}
{% endschema %}